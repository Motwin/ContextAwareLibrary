<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>context-aware-doc: Context Awareness Android Developer Guide</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">context-aware-doc
   &#160;<span id="projectnumber">${project.version}</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Context Awareness Android Developer Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Motwin Context Awareness library is a messaging-based library that provides an API to collect Context information from mobile devices, and send them to the server.<br/>
 <br/>
 A Context Element has a Type and some Data (that can be of any type).<br/>
 A Collector must implement Collector interface which requires 3 methods : start, stop and sendContextElement.<br/>
 The AbstractCollector class implements sendContextElement method for you. We also defined 3 base classes for custom Collectors : </p>
<ul>
<li>AbstractOneShotCollector that will send ContextElement once on start </li>
<li>AbstractOnChangeCollector that will send ContextElement each time it changes </li>
<li>AbstractPeriodicCollector that will send ContextElement at regular interval <br/>
 You can define you own Context Element and Collector by overriding one of the previous Abstract classes. You can also use one of the predefined Collectors provided in the library. See <a class="el" href="_context_aware_android_dev_guide.html#CollectorsTable">Table of predefined ContextElements and Collectors</a>.<br/>
</li>
</ul>
<h2><a class="anchor" id="InitContextRegistry"></a>
Initializing the Context Collector Registry</h2>
<p>Context Awareness Library entry point is the ContextCollectorRegistryFactory. It allows to create a Registry of Context Collectors, as follows : </p>
<div class="fragment"><pre class="fragment">ContextCollectorRegistry contextCollectorRegistry = ContextCollectorRegistryFactory.build(clientChannel, applicationContext, collectors);
</pre></div><p> The required parameters are : </p>
<ul>
<li>clientChannel : the ClientChannel used to forward ContextElements to the server. </li>
<li>applicationContext : as almost every class in Android, ContextCollectorRegistry requires an instance of Context. Here, we need the Application Context. </li>
<li>collectors : the list of Collectors to be activated.</li>
</ul>
<h3><a class="anchor" id="caadgStartSec1"></a>
Starting Context Collection</h3>
<p>In order to start context collection, you must call <b>start()</b>, for instance when your first Activity is started. </p>
<div class="fragment"><pre class="fragment">contextCollectorRegistry.start();
</pre></div><p> This will start all the Collectors declared in the Registry</p>
<h3><a class="anchor" id="caadgStartSec2"></a>
Stopping Context Collection</h3>
<p>In order to stop context collection , you must call <b>stop()</b>, for instance when your first Activity is stopped. </p>
<div class="fragment"><pre class="fragment">contextCollectorRegistry.stop();
</pre></div><p> This will start all the Collectors declared in the Registry</p>
<h3><a class="anchor" id="caadgStartSec4"></a>
Manually Enable an additional Context Collector</h3>
<p>If you need to add a new Context Collector after starting the Registry, by using the following code : </p>
<div class="fragment"><pre class="fragment">contextCollectorRegistry.enableContextCollector(contextCollector);
</pre></div><h3><a class="anchor" id="caadgStartSec5"></a>
Manually Disable a Context Collector</h3>
<p>You can also disable a Context Collector before stopping the Registry as follows : </p>
<div class="fragment"><pre class="fragment">contextCollectorRegistry.disableContextCollector(contextCollector);
</pre></div><h2><a class="anchor" id="CustomCollector"></a>
Create your custom Context Element and Collector</h2>
<p>A custom collector can extend one of the 4 following abstract classes : </p>
<ul>
<li>AbstractOneShotCollector : context collector that forwards context element once on start </li>
<li>AbstractOnChangeCollector : context collector that forwards context element each time it changes </li>
<li>AbstractPeriodicCollector : context collector that forwards context element at regular interval </li>
<li>AbstractCollector : default context collector. These 4 classes use generic type that defines the type of the ContextElement data.</li>
</ul>
<h3><a class="anchor" id="caadgcuSec1"></a>
One Shot Context Collector</h3>
<p>When extending AbstractOneShotCollector, you need to implement the abstract method collect(), which returns the ContextElement that will be forwarded to the server when collector is started.<br/>
 Here is an example of One Shot Collector that collects the device type. </p>
<div class="fragment"><pre class="fragment"><span class="keyword">public</span> <span class="keyword">class </span>DeviceTypeCollector <span class="keyword">extends</span> AbstractOneShotCollector&lt;String&gt; {

    <span class="keyword">public</span> DeviceTypeCollector(ClientChannel aClientChannel, Context aApplicationContext) {
        super(aClientChannel, aApplicationContext);
    }

    @Override
    <span class="keyword">public</span> ContextElement&lt;String&gt; collect() {
        String deviceType = android.os.Build.MODEL;
        ContextElement&lt;String&gt; contextElement = <span class="keyword">new</span> ContextElement&lt;String&gt;(ContextAware.DEVICE_TYPE_KEY, deviceType);
        <span class="keywordflow">return</span> contextElement;
    }

}
</pre></div> <dl class="note"><dt><b>Note:</b></dt><dd>If the ContextElement returned by the collect method is null, the element will not be forwarded to the server.</dd></dl>
<h3><a class="anchor" id="caadgcuSec2"></a>
On Change Context Collector</h3>
<p>When extending AbstractOnChangeCollector, you need to implement the abstract methods start() and stop(), which should register / unregister the listener to the value of the context element. When the listener is notified with a new value, it should call onChange method to forward the context element to the server.<br/>
 Here is an example of On Change Collector that collects the device type. </p>
<div class="fragment"><pre class="fragment"><span class="keyword">public</span> <span class="keyword">class </span>ChargingStateCollector <span class="keyword">extends</span> AbstractOnChangeCollector&lt;Boolean&gt; {

    <span class="keyword">private</span> <span class="keyword">final</span> BroadcastReceiver batteryReceiver;

    <span class="keyword">public</span> ChargingStateCollector(ClientChannel aClientChannel, Context aApplicationContext, <span class="keywordtype">long</span> aMinDelay) {
        super(aClientChannel, aApplicationContext, aMinDelay);
        batteryReceiver = <span class="keyword">new</span> BroadcastReceiver() {
            @Override
            <span class="keyword">public</span> <span class="keywordtype">void</span> onReceive(Context c, Intent anIntent) {
                handleBatterieChangeEvent(anIntent);

            }
        };
    }

    @Override
    <span class="keyword">public</span> <span class="keywordtype">void</span> start() {
        Intent intent = getApplicationContext().registerReceiver(batteryReceiver,
                <span class="keyword">new</span> IntentFilter(Intent.ACTION_BATTERY_CHANGED));
        <span class="comment">// using sticky broadcast to init the charger type.</span>
        <span class="keywordflow">if</span> (intent != null) {
            handleBatterieChangeEvent(intent);
        }

    }

    @Override
    <span class="keyword">public</span> <span class="keywordtype">void</span> stop() {
        getApplicationContext().unregisterReceiver(batteryReceiver);

    }

    <span class="keyword">protected</span> <span class="keywordtype">void</span> handleBatterieChangeEvent(Intent anIntent) {
        Preconditions.checkNotNull(anIntent, <span class="stringliteral">&quot;Intent cannot be null&quot;</span>);

        <span class="keywordtype">int</span> chargePlug = anIntent.getIntExtra(BatteryManager.EXTRA_PLUGGED, 0);
        <span class="keywordtype">boolean</span> isCharging = chargePlug != 0;

        ContextElement&lt;Boolean&gt; contextElement = <span class="keyword">new</span> ContextElement&lt;Boolean&gt;(ContextAware.CHARGING_STATE_KEY,
                isCharging);
        onChange(contextElement);

    }
}
</pre></div><dl class="note"><dt><b>Note:</b></dt><dd>The AbstractOnChangeCollector constructor requires an additional parameter called aMinDelay which defines the minimum delay between context upadtes, in milliseconds.<br/>
 When onChange method is called, AbstractOnChangeCollector will forward the context element to the server if <ul>
<li>the value of the new context element is different from the previous value. </li>
<li>the last context element was sent more that aMinDelay ago.</li>
</ul>
aMinDelay must be &gt;= 0. If value is 0, context element will be forwarded each time the value changes.</dd></dl>
<h3><a class="anchor" id="caadgcuSec3"></a>
Periodic Context Collector</h3>
<p>When extending AbstractPeriodicCollector, you need to implement the abstract method collect(), which will be called periodically to get the ContextElement to forward to the server. You can also implement onStart() and onStop() methods, to initialize / dispose some listeners to get the context element.<br/>
 Here is an example of Periodic Collector that collects the device type. </p>
<div class="fragment"><pre class="fragment"><span class="keyword">public</span> <span class="keyword">class </span>BatteryLevelPeriodicCollector <span class="keyword">extends</span> AbstractPeriodicCollector&lt;String&gt; {

    <span class="keyword">public</span> BatteryLevelPeriodicCollector(ClientChannel aClientChannel, Context aApplicationContext,
            <span class="keywordtype">long</span> aPeriodInMilliSeconds) {
        super(aClientChannel, aApplicationContext, aPeriodInMilliSeconds);
    }

    @Override
    <span class="keyword">public</span> ContextElement&lt;String&gt; collect() {
        Intent intent = getApplicationContext().registerReceiver(null, <span class="keyword">new</span> IntentFilter(Intent.ACTION_BATTERY_CHANGED));

        <span class="keywordtype">int</span> level;
        level = getLevel(intent);

        <span class="keywordtype">int</span> scale;
        scale = getScale(intent);

        ContextElement&lt;String&gt; contextElement = <span class="keyword">new</span> ContextElement&lt;String&gt;(ContextAware.BATTERY_LEVEL_KEY,
                String.format(<span class="stringliteral">&quot;%d/%d&quot;</span>, level, scale));
        <span class="keywordflow">return</span> contextElement;
    }

    <span class="keyword">protected</span> <span class="keywordtype">int</span> getLevel(Intent aIntent) {
        <span class="keywordtype">int</span> level = 0;
        <span class="keywordflow">if</span> (aIntent != null) {
            level = aIntent.getIntExtra(BatteryManager.EXTRA_LEVEL, 0);
        }
        <span class="keywordflow">return</span> level;
    }

    <span class="keyword">protected</span> <span class="keywordtype">int</span> getScale(Intent aIntent) {
        <span class="keywordtype">int</span> level = 0;
        <span class="keywordflow">if</span> (aIntent != null) {
            level = aIntent.getIntExtra(BatteryManager.EXTRA_SCALE, 0);
        }
        <span class="keywordflow">return</span> level;
    }

    @Override
    <span class="keyword">public</span> <span class="keywordtype">void</span> onStart() {
        <span class="comment">// NOOP</span>

    }

    @Override
    <span class="keyword">public</span> <span class="keywordtype">void</span> onStop() {
        <span class="comment">// NOOP</span>

    }

}
</pre></div> <dl class="note"><dt><b>Note:</b></dt><dd>The AbstractPeriodicCollector constructor requires an additional parameter called aPeriodInMilliSeconds which defines the delay between context updates, in milliseconds. It must be &gt; 0.</dd></dl>
<h2><a class="anchor" id="caadgcuSec4"></a>
Other Custom Context Collector</h2>
<p>If none of the 3 default collection mode (One Shot, On Change, Periodic) suits your needs, you can extend the AbstractCollector. You will need to implement <b>start()</b> and <b>stop()</b> methods, and manually call sendContextElement method when ready to forward a context element to the server.<br/>
</p>
<h2><a class="anchor" id="ContextTagging"></a>
Focus on a specific ContextCollector : the TagCollector</h2>
<p>The Context Awareness library provides a predefined ContextCollector called the TagCollector. This is a utility class that can be usefull to setup user tracking.<br/>
 For instance, if you want to know the navigation path of you users, you can decide to tag each activity in your application. The following Activity could be used as base class for all Activities in your application, and will automatically send tag to the server as soon as the user navigates to the activity. </p>
<div class="fragment"><pre class="fragment"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class </span>TaggedActivity <span class="keyword">extends</span> Activity {

    <span class="keyword">private</span> <span class="keyword">final</span> String tag;

    <span class="keyword">public</span> TaggedActivity(String aTag) {
        super();
        tag = Preconditions.checkNotNull(aTag, <span class="stringliteral">&quot;aTag cannot be null&quot;</span>);

    }

    @Override
    <span class="keyword">protected</span> <span class="keywordtype">void</span> onCreate(Bundle aSavedInstanceState) {
        super.onCreate(aSavedInstanceState);
        <span class="keywordflow">if</span> (isTaskRoot()) {
            MotwinFacade.initSettings(getApplicationContext());
        }
    }

    @Override
    <span class="keyword">protected</span> <span class="keywordtype">void</span> onStart() {
        super.onStart();

        MotwinFacade.connect();

    }

    @Override
    <span class="keyword">protected</span> <span class="keywordtype">void</span> onStop() {
        super.onStop();

        MotwinFacade.disconnect();

    }

    @Override
    <span class="keyword">protected</span> <span class="keywordtype">void</span> onResume() {
        super.onResume();

        MotwinFacade.getTagCollector().setTag(tag);
    }

    @Override
    <span class="keyword">protected</span> <span class="keywordtype">void</span> onDestroy() {
        super.onDestroy();

        <span class="keywordflow">if</span> (isTaskRoot()) {
            MotwinFacade.destroy();
        }
    }
}
</pre></div><h2><a class="anchor" id="CollectorsTable"></a>
Table of predefined ContextElements and Collectors</h2>
<p>The following table shows the list of predefined Context elements, and the associated Collectors.<br/>
 Each Collector takes at least 2 parameters : the ClientChannel that will be used to forward Context Elements to the server, and the Android Context.<br/>
 The Collectors utility class allows you to instanciate each one of these collectors. You can use the Collectors.Builder class to pass ClientChannel and Context arguments only once. </p>
<table class="doxtable">
<tr>
<th>ContextElement Type </th><th>ContextElement Data Type </th><th>Collector Class </th><th>Collector Type </th><th>Parameters  </th></tr>
<tr>
<td>"accelerometerData" </td><td>AccelerometerData </td><td>AccelerometerOnChangeCollector </td><td>On Change </td><td><ul>
<li>aMinDelay : minimum delay between context updates, in milliseconds  </li>
</ul>
</td></tr>
<tr>
<td>"batteryLevel" </td><td>String<br/>
&lt;level&gt;/&lt;scale&gt; </td><td>BatteryLevelPeriodicCollector </td><td>Periodic </td><td><ul>
<li>aPeriodInMilliSeconds : delay between context updates, in milliseconds  </li>
</ul>
</td></tr>
<tr>
<td>"chargerType" </td><td>String<br/>
"USB", "AC", "Wireless", or "None" </td><td>ChargerTypeCollector </td><td>On Change </td><td><ul>
<li>aMinDelay : minimum delay between context updates, in milliseconds  </li>
</ul>
</td></tr>
<tr>
<td>"chargingState" </td><td>Boolean<br/>
TRUE if is charging, FALSE otherwise </td><td>ChargingStateCollector </td><td>On Change </td><td><ul>
<li>aMinDelay : minimum delay between context updates, in milliseconds  </li>
</ul>
</td></tr>
<tr>
<td>"cashEvent" </td><td>String<br/>
the stack trace of the exception </td><td>CrashEventCollector </td><td>On Change </td><td><ul>
<li>aExceptionHandler : a custom exception handler. Can be null (will then use the Thread default exception handler)  </li>
</ul>
</td></tr>
<tr>
<td>"deviceOsVersion" </td><td>String<br/>
the <a href="http://developer.android.com/reference/android/os/Build.VERSION.html#RELEASE">Build.VERSION.RELEASE</a> value) </td><td>DeviceOSVersionCollector </td><td>One Shot </td><td></td></tr>
<tr>
<td>"deviceType" </td><td>String<br/>
the <a href="http://developer.android.com/reference/android/os/Build.html#MODEL">Build.MODEL</a> value) </td><td>DeviceTypeCollector </td><td>One Shot </td><td></td></tr>
<tr>
<td>"dockState" </td><td>Boolean<br/>
TRUE if is docked, FALSE otherwise </td><td>DockStateCollector </td><td>On Change </td><td><ul>
<li>aMinDelay : minimum delay between context updates, in milliseconds  </li>
</ul>
</td></tr>
<tr>
<td>"dockType" </td><td>String<br/>
"Desk", "Car", "Analog", "Digital", "None",or "Unknown" </td><td>DockTypeCollector </td><td>On Change </td><td><ul>
<li>aMinDelay : minimum delay between context updates, in milliseconds  </li>
</ul>
</td></tr>
<tr>
<td>"geolocation" </td><td>GeoLocData </td><td>GeolocationOnChangeCollector </td><td>On Change </td><td><ul>
<li>aMinDistance : minimum distance between location updates, in meters  </li>
</ul>
</td></tr>
<tr>
<td>"periodicGeolocation" </td><td>GeoLocData </td><td>GeolocationPeriodicCollector </td><td>Periodic </td><td><ul>
<li>aDelay : delay between context updates, in milliseconds  </li>
</ul>
</td></tr>
<tr>
<td>"language" </td><td>String<br/>
the language code for the default Locale </td><td>LanguageCollector </td><td>One Shot </td><td></td></tr>
<tr>
<td>"mobileCountryCode" </td><td>String<br/>
MCC </td><td>MobileCountryCodeCollector </td><td>One Shot </td><td></td></tr>
<tr>
<td>"mobileNetworkCode" </td><td>String<br/>
MNC </td><td>MobileNetworkCodeCollector </td><td>One Shot </td><td></td></tr>
<tr>
<td>"cellId" </td><td>String<br/>
GSM cell id </td><td>NetworkIdentifierCollector </td><td>One Shot </td><td></td></tr>
<tr>
<td>"networkReceptionStrengh" </td><td>String<br/>
GSM Signal Strength. Valid values are (0-31, 99) as defined in TS 27.007 8.5 </td><td>NetworkReceptionCollector </td><td>On Change </td><td><ul>
<li>aMinDelay : minimum delay between context updates, in milliseconds  </li>
</ul>
</td></tr>
<tr>
<td>"dataNetworkType" </td><td>String<br/>
the type of the network, for example "WIFI" or "MOBILE" </td><td>NetworkTypeCollector </td><td>On Change </td><td><ul>
<li>aMinDelay : minimum delay between context updates, in milliseconds  </li>
</ul>
</td></tr>
<tr>
<td>"roaming" </td><td>Boolean<br/>
TRUE if is roaming, FALSE otherwise </td><td>RoamingCollector </td><td>One Shot </td><td></td></tr>
<tr>
<td>"roamingCountryCode" </td><td>String<br/>
"International Roaming", "National Roaming", or "N.A." if not roaming </td><td>RoamingCountryCodeCollector </td><td>One Shot </td><td></td></tr>
<tr>
<td>"screenOrientation" </td><td>String<br/>
"Landscape", "Portrait",or "Unknown" </td><td>ScreenOrientationCollector </td><td>On Change </td><td><ul>
<li>aMinDelay : minimum delay between context updates, in milliseconds  </li>
</ul>
</td></tr>
<tr>
<td>"simState" </td><td>String<br/>
"Absent", "Network Locked", "Pin Required", "Puk Required", "Ready", or "Unknown" </td><td>SimStateCollector </td><td>One Shot </td><td></td></tr>
<tr>
<td>"soundMode" </td><td>String<br/>
"Normal", "Vibrate", "Silent", or "Unknown" </td><td>SoundModeCollector </td><td>On Change </td><td><ul>
<li>aMinDelay : minimum delay between context updates, in milliseconds  </li>
</ul>
</td></tr>
<tr>
<td>"soundOutput" </td><td>String<br/>
"Speakers", "Music", "Microphone Mute", "Bluetooth", or "Unknown" </td><td>SoundOutputCollector </td><td>On Change </td><td><ul>
<li>aMinDelay : minimum delay between context updates, in milliseconds  </li>
</ul>
</td></tr>
<tr>
<td>"tag" </td><td>String<br/>
the Tag </td><td>TagCollector </td><td>On Change </td><td></td></tr>
<tr>
<td>"timeZone" </td><td>String<br/>
example : GMT+1:00 </td><td>TimeZoneCollector </td><td>One Shot </td><td></td></tr>
</table>
</div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Jul 16 2014 08:15:24 for context-aware-doc by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
